<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>商家列表</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <style>
        html,
        body {
            height: 100%;
            background-color: #f0f0f0;
        }
        
        .h80 {
            height: 80px;
        }
        
        .h40 {
            height: 40px;
        }
        
        .h20 {
            height: 20px;
        }
        
        .h10 {
            height: 10px;
            background: #f0f0f0;
        }
        
        .h1 {
            height: 1px;
            margin-left: 15px;
            background: #f0f0f0;
        }
        
        .fr {
            float: right;
        }
        
        .fl {
            float: left;
        }
        
        .hightitem {
            background-color: #fff;
        }
        
        .row {
            display: -webkit-box;
            display: -webkit-flex;
        }
        
        .col {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            position: relative;
        }
        
        .col img {
            position: absolute;
            right: 0;
            width: 80px;
            top: 0;
        }
        
        .col .matrixcell {
            display: table-cell;
            vertical-align: middle;
            padding-left: 10px;
        }
        
        .col .matrixcell .title {
            margin-bottom: 10px;
        }
        
        .matrix {
            display: table;
            height: inherit;
        }
        
        .home-tuan-list .item {
            position: relative;
            display: block;
            padding-left: 10px;
        }
        
        .home-tuan-list .cnt {
            padding: 7px 10px 10px 0;
            display: box;
            display: -webkit-box;
            height: 78px;
            background-size: auto 1px;
        }
        
        .home-tuan-list .pic {
            margin-right: 10px;
            background: center;
        }
        
        .home-tuan-list img {
            width: 90px;
            height: 66px;
            margin-top: 7px;
            margin-bottom: 5px;
            border-radius: 3px;
        }
        
        .home-tuan-list .wrap {
            -webkit-box-flex: 1;
        }
        
        .home-tuan-list .wrap2 {
            display: table;
            height: 88px;
            width: 100%;
        }
        
        .home-tuan-list .content {
            -webkit-box-flex: 1;
            box-flex: 1;
            display: table-cell;
            vertical-align: middle;
        }
        
        .home-tuan-list .shopname {
            color: #333;
            /*line-height: 16px;*/
            font-size: 17px;
            max-width: 11em;
            white-space: nowrap;
            word-wrap: normal;
            text-overflow: ellipsis;
            overflow: hidden;
            min-height: 10px;
            padding-bottom: 2px;
            padding-top: 3px;
            display: inline-block;
        }
        
        .home-tuan-list .title {
            color: #666;
            line-height: 16px;
            font-size: 13px;
            max-height: 30px;
            overflow: hidden;
            padding-top: 3px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .home-tuan-list .hot-title {
            margin-bottom: 8px;
        }
        
        .home-tuan-list .hot-subtitle {
            margin-bottom: 9px;
        }
        
        .home-tuan-list .info {
            margin-top: 6px;
            margin-bottom: 6px;
            color: #666;
            font-size: 12px;
            position: relative;
            line-height: 15px;
            display: box;
            display: -webkit-box;
            height: 15px;
        }
        
        .home-tuan-list .comment {
            margin-bottom: 6px;
            position: relative;
        }
        
        .home-tuan-list .comment span {
            vertical-align: middle;
            color: #666;
            font-size: 12px;
        }
        
        .home-tuan-list .star {
            display: inline-block;
            width: 66px;
            height: 12px;
            vertical-align: middle;
            background: url(../../image/remark.png) no-repeat;
            background-size: 86px auto;
        }
        
        .star.star-50 {
            background-position: 0 -215px;
        }
        
        .star.star-45 {
            background-position: 0 -232px;
        }
        
        .star.star-40 {
            background-position: 0 -249px;
        }
        
        .home-tuan-list .star {
            margin-right: 10px;
        }
        
        .home-tuan-list .symbol {
            font-size: 14px;
            color: #f60;
            display: block;
            margin-top: 1px;
        }
        
        .home-tuan-list .price {
            color: #f60;
            font-size: 20px;
            line-height: 15px;
            margin-right: 5px;
            margin-top: 1px;
        }
        
        .home-tuan-list .o-price {
            color: #999;
            margin-top: 5px;
            line-height: 10px;
        }
        
        .home-tuan-list .sale {
            color: #f63;
            border: solid 1px #ff916e;
            padding: 3px 2px 2px;
            font-size: 10px;
            border-radius: 2px;
            -webkit-border-radius: 2px;
            margin-left: 5px;
            line-height: 10px;
            height: 10px;
        }
        
        .home-tuan-list .tuanimg img {
            /*float: left; margin-top: 7px;*/
            width: 16px;
            height: 16px;
            margin-left: 3px;
            vertical-align: top;
            position: absolute;
            top: 12px;
        }
        
        .home-tuan-list .distance {
            -webkit-box-flex: 1;
            box-flex: 1;
            -ms-box-flex: 1;
            -ms-flex: 1;
            text-align: right;
            line-height: 10px;
            margin-top: 5px;
            color: #999;
            float: right;
            font-size: 12px;
        }
        
        .home-tuan-list .distance img {
            width: 10px;
            height: 10px;
            vertical-align: top;
            margin: 0;
        }
        
        .home-tuan-list .classify {
            color: #666;
            font-size: 14px;
        }
        
        .home-tuan-list .price,
        .index-rec .home-tuan-list .o-price,
        .index-rec .home-tuan-list .distance,
        .index-rec .home-tuan-list .sale {
            display: block;
            line-height: 15px;
            font-size: 12px;
        }
        
        .Fix:after {
            display: block;
            content: '';
            height: 0;
            clear: both;
        }
        
        .item-hov {
            background-color: #FAFAFA !important;
        }
    </style>
</head>

<body>
    <section id="list" class="home-tuan-list"></section>
</body>
<script id="dotTemplate" type="text/template">
    {{ for(var i=0;i<it.length;i++) { }} 
        <div class="item Fix hightitem">
            <div class="cnt">
                <img class="pic" src="../image/shopcover/loading.jpg">
                <div class="wrap">
                    <div class="wrap2">
                        <div class="content">
                            <div class="shopname">:{{= it[i].name }}</div>
                            <div class="comment">
                                <span class="star star-50"></span>
                                <span>￥价格:{{= it[i].price }}</span>
                            </div>
                            <span class="classify">{{= types[it[i].shopType] }}</span>
                            <span class="distance"><img src="../image/distance.png">100m</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {{ } }}
</script>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/SHA1.js"></script>
<script type="text/javascript" src="../script/APICloud-rest.js"></script>
<script type="text/javascript" src="../script/doT.min.js"></script>
<script type="text/javascript">
    function fnGetData(shopType) {
        var client = new Resource("A6055538104405", "EE42ED9D-BA7E-F584-C9D3-335174CD05CF");
        var Shop = client.Factory("shop");
        Shop.query({
            "filter": {
                "fields": {
                    "createdAt": false,
                    "updatedAt": false
                },
                "where": {
                    "shopType": shopType
                },
                "skip": 0,
                "limit": 20
            }
        }, function(ret, err) {
            fnShowData(ret);
        });
    };

    var types = ['商户', '团购'];

    function fnShowData(datas) {
        // var count = 0;
        // var html = '';
        // while (count < datas.length) {
        //     html += '<div class="item Fix hightitem">' + '<div class="cnt">' + '<img class="pic" src="../image/shopcover/loading.jpg">' + '<div class="wrap">' + '<div class="wrap2">' + '<div class="content">' + '<div class="shopname">' + datas[count].name + '</div>' + '<div class="comment">' + '<span class="star star-50"></span>' + '<span>￥价格:' + datas[count].money + '</span>' + '</div>' + '<span class="classify">' + types[datas[count].shopType] + '</span>' + '<span class="distance"><img src="../image/distance.png">100m</span>' + '</div>' + '</div>' + '</div>' + '</div>' + '</div>';
        //     count++;
        // }
        // list.innerHTML=html;

        list.innerHTML = dotFunction(datas);
        api.refreshHeaderLoadDone();
    };

    var list, tmp, dotFunction;
    apiready = function() {
        list = $api.byId('list');
        tmp = $api.byId('dotTemplate');
        dotFunction = doT.template(tmp.innerHTML);
        
        // fnGetData(api.pageParam.shopType);


        api.setRefreshHeaderInfo({
            visible: true,
            loadingImg: 'widget://image/find/logo_01.png',
            bgColor: '#ccc',
            textColor: '#fff',
            textDown: '下拉刷新...',
            textUp: '松开刷新...',
            showTime: true
        }, function(ret, err){
            fnGetData(api.pageParam.shopType);

        });
        api.refreshHeaderLoading();
    };
</script>

</html>
